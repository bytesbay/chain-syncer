(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["chain-syncer"]=e():t["chain-syncer"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s="fb15")}({"00ee":function(t,e,r){var n=r("b622"),o=n("toStringTag"),i={};i[o]="z",t.exports="[object z]"===String(i)},"06cf":function(t,e,r){var n=r("83ab"),o=r("c65b"),i=r("d1e7"),s=r("5c6c"),c=r("fc6a"),a=r("a04b"),u=r("1a2d"),f=r("0cfb"),l=Object.getOwnPropertyDescriptor;e.f=n?l:function(t,e){if(t=c(t),e=a(e),f)try{return l(t,e)}catch(r){}if(u(t,e))return s(!o(i.f,t,e),t[e])}},"07fa":function(t,e,r){var n=r("50c4");t.exports=function(t){return n(t.length)}},"0cfb":function(t,e,r){var n=r("83ab"),o=r("d039"),i=r("cc12");t.exports=!n&&!o((function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},"0d51":function(t,e){var r=String;t.exports=function(t){try{return r(t)}catch(e){return"Object"}}},"13d2":function(t,e,r){var n=r("d039"),o=r("1626"),i=r("1a2d"),s=r("83ab"),c=r("5e77").CONFIGURABLE,a=r("8925"),u=r("69f3"),f=u.enforce,l=u.get,d=Object.defineProperty,h=s&&!n((function(){return 8!==d((function(){}),"length",{value:8}).length})),p=String(String).split("String"),b=t.exports=function(t,e,r){"Symbol("===String(e).slice(0,7)&&(e="["+String(e).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(e="get "+e),r&&r.setter&&(e="set "+e),(!i(t,"name")||c&&t.name!==e)&&(s?d(t,"name",{value:e,configurable:!0}):t.name=e),h&&r&&i(r,"arity")&&t.length!==r.arity&&d(t,"length",{value:r.arity});try{r&&i(r,"constructor")&&r.constructor?s&&d(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(o){}var n=f(t);return i(n,"source")||(n.source=p.join("string"==typeof e?e:"")),t};Function.prototype.toString=b((function(){return o(this)&&l(this).source||a(this)}),"toString")},"13d5":function(t,e,r){"use strict";var n=r("23e7"),o=r("d58f").left,i=r("a640"),s=r("2d00"),c=r("605d"),a=i("reduce"),u=!c&&s>79&&s<83;n({target:"Array",proto:!0,forced:!a||u},{reduce:function(t){var e=arguments.length;return o(this,t,e,e>1?arguments[1]:void 0)}})},1626:function(t,e){t.exports=function(t){return"function"==typeof t}},"1a2d":function(t,e,r){var n=r("e330"),o=r("7b0b"),i=n({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return i(o(t),e)}},"1be4":function(t,e,r){var n=r("d066");t.exports=n("document","documentElement")},"1d80":function(t,e){var r=TypeError;t.exports=function(t){if(void 0==t)throw r("Can't call method on "+t);return t}},"23cb":function(t,e,r){var n=r("5926"),o=Math.max,i=Math.min;t.exports=function(t,e){var r=n(t);return r<0?o(r+e,0):i(r,e)}},"23e7":function(t,e,r){var n=r("da84"),o=r("06cf").f,i=r("9112"),s=r("cb2d"),c=r("6374"),a=r("e893"),u=r("94ca");t.exports=function(t,e){var r,f,l,d,h,p,b=t.target,v=t.global,_=t.stat;if(f=v?n:_?n[b]||c(b,{}):(n[b]||{}).prototype,f)for(l in e){if(h=e[l],t.dontCallGetSet?(p=o(f,l),d=p&&p.value):d=f[l],r=u(v?l:b+(_?".":"#")+l,t.forced),!r&&void 0!==d){if(typeof h==typeof d)continue;a(h,d)}(t.sham||d&&d.sham)&&i(h,"sham",!0),s(f,l,h,t)}}},"241c":function(t,e,r){var n=r("ca84"),o=r("7839"),i=o.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return n(t,i)}},"2ba4":function(t,e,r){var n=r("40d5"),o=Function.prototype,i=o.apply,s=o.call;t.exports="object"==typeof Reflect&&Reflect.apply||(n?s.bind(i):function(){return s.apply(i,arguments)})},"2d00":function(t,e,r){var n,o,i=r("da84"),s=r("342f"),c=i.process,a=i.Deno,u=c&&c.versions||a&&a.version,f=u&&u.v8;f&&(n=f.split("."),o=n[0]>0&&n[0]<4?1:+(n[0]+n[1])),!o&&s&&(n=s.match(/Edge\/(\d+)/),(!n||n[1]>=74)&&(n=s.match(/Chrome\/(\d+)/),n&&(o=+n[1]))),t.exports=o},"342f":function(t,e,r){var n=r("d066");t.exports=n("navigator","userAgent")||""},"37e8":function(t,e,r){var n=r("83ab"),o=r("aed9"),i=r("9bf2"),s=r("825a"),c=r("fc6a"),a=r("df75");e.f=n&&!o?Object.defineProperties:function(t,e){s(t);var r,n=c(e),o=a(e),u=o.length,f=0;while(u>f)i.f(t,r=o[f++],n[r]);return t}},"3a9b":function(t,e,r){var n=r("e330");t.exports=n({}.isPrototypeOf)},"3bbe":function(t,e,r){var n=r("1626"),o=String,i=TypeError;t.exports=function(t){if("object"==typeof t||n(t))return t;throw i("Can't set "+o(t)+" as a prototype")}},"40d5":function(t,e,r){var n=r("d039");t.exports=!n((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},"44ad":function(t,e,r){var n=r("e330"),o=r("d039"),i=r("c6b6"),s=Object,c=n("".split);t.exports=o((function(){return!s("z").propertyIsEnumerable(0)}))?function(t){return"String"==i(t)?c(t,""):s(t)}:s},"44d2":function(t,e,r){var n=r("b622"),o=r("7c73"),i=r("9bf2").f,s=n("unscopables"),c=Array.prototype;void 0==c[s]&&i(c,s,{configurable:!0,value:o(null)}),t.exports=function(t){c[s][t]=!0}},"485a":function(t,e,r){var n=r("c65b"),o=r("1626"),i=r("861d"),s=TypeError;t.exports=function(t,e){var r,c;if("string"===e&&o(r=t.toString)&&!i(c=n(r,t)))return c;if(o(r=t.valueOf)&&!i(c=n(r,t)))return c;if("string"!==e&&o(r=t.toString)&&!i(c=n(r,t)))return c;throw s("Can't convert object to primitive value")}},4930:function(t,e,r){var n=r("2d00"),o=r("d039");t.exports=!!Object.getOwnPropertySymbols&&!o((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},"4d64":function(t,e,r){var n=r("fc6a"),o=r("23cb"),i=r("07fa"),s=function(t){return function(e,r,s){var c,a=n(e),u=i(a),f=o(s,u);if(t&&r!=r){while(u>f)if(c=a[f++],c!=c)return!0}else for(;u>f;f++)if((t||f in a)&&a[f]===r)return t||f||0;return!t&&-1}};t.exports={includes:s(!0),indexOf:s(!1)}},"50c4":function(t,e,r){var n=r("5926"),o=Math.min;t.exports=function(t){return t>0?o(n(t),9007199254740991):0}},5692:function(t,e,r){var n=r("c430"),o=r("c6cd");(t.exports=function(t,e){return o[t]||(o[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.23.3",mode:n?"pure":"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.23.3/LICENSE",source:"https://github.com/zloirock/core-js"})},"56ef":function(t,e,r){var n=r("d066"),o=r("e330"),i=r("241c"),s=r("7418"),c=r("825a"),a=o([].concat);t.exports=n("Reflect","ownKeys")||function(t){var e=i.f(c(t)),r=s.f;return r?a(e,r(t)):e}},"577e":function(t,e,r){var n=r("f5df"),o=String;t.exports=function(t){if("Symbol"===n(t))throw TypeError("Cannot convert a Symbol value to a string");return o(t)}},5926:function(t,e,r){var n=r("b42e");t.exports=function(t){var e=+t;return e!==e||0===e?0:n(e)}},"59ed":function(t,e,r){var n=r("1626"),o=r("0d51"),i=TypeError;t.exports=function(t){if(n(t))return t;throw i(o(t)+" is not a function")}},"5c6c":function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},"5e77":function(t,e,r){var n=r("83ab"),o=r("1a2d"),i=Function.prototype,s=n&&Object.getOwnPropertyDescriptor,c=o(i,"name"),a=c&&"something"===function(){}.name,u=c&&(!n||n&&s(i,"name").configurable);t.exports={EXISTS:c,PROPER:a,CONFIGURABLE:u}},"605d":function(t,e,r){var n=r("c6b6"),o=r("da84");t.exports="process"==n(o.process)},6374:function(t,e,r){var n=r("da84"),o=Object.defineProperty;t.exports=function(t,e){try{o(n,t,{value:e,configurable:!0,writable:!0})}catch(r){n[t]=e}return e}},"69f3":function(t,e,r){var n,o,i,s=r("7f9a"),c=r("da84"),a=r("e330"),u=r("861d"),f=r("9112"),l=r("1a2d"),d=r("c6cd"),h=r("f772"),p=r("d012"),b="Object already initialized",v=c.TypeError,_=c.WeakMap,m=function(t){return i(t)?o(t):n(t,{})},y=function(t){return function(e){var r;if(!u(e)||(r=o(e)).type!==t)throw v("Incompatible receiver, "+t+" required");return r}};if(s||d.state){var g=d.state||(d.state=new _),w=a(g.get),x=a(g.has),E=a(g.set);n=function(t,e){if(x(g,t))throw new v(b);return e.facade=t,E(g,t,e),e},o=function(t){return w(g,t)||{}},i=function(t){return x(g,t)}}else{var k=h("state");p[k]=!0,n=function(t,e){if(l(t,k))throw new v(b);return e.facade=t,f(t,k,e),e},o=function(t){return l(t,k)?t[k]:{}},i=function(t){return l(t,k)}}t.exports={set:n,get:o,has:i,enforce:m,getterFor:y}},7156:function(t,e,r){var n=r("1626"),o=r("861d"),i=r("d2bb");t.exports=function(t,e,r){var s,c;return i&&n(s=e.constructor)&&s!==r&&o(c=s.prototype)&&c!==r.prototype&&i(t,c),t}},7418:function(t,e){e.f=Object.getOwnPropertySymbols},7839:function(t,e){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},"7b0b":function(t,e,r){var n=r("1d80"),o=Object;t.exports=function(t){return o(n(t))}},"7c73":function(t,e,r){var n,o=r("825a"),i=r("37e8"),s=r("7839"),c=r("d012"),a=r("1be4"),u=r("cc12"),f=r("f772"),l=">",d="<",h="prototype",p="script",b=f("IE_PROTO"),v=function(){},_=function(t){return d+p+l+t+d+"/"+p+l},m=function(t){t.write(_("")),t.close();var e=t.parentWindow.Object;return t=null,e},y=function(){var t,e=u("iframe"),r="java"+p+":";return e.style.display="none",a.appendChild(e),e.src=String(r),t=e.contentWindow.document,t.open(),t.write(_("document.F=Object")),t.close(),t.F},g=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}g="undefined"!=typeof document?document.domain&&n?m(n):y():m(n);var t=s.length;while(t--)delete g[h][s[t]];return g()};c[b]=!0,t.exports=Object.create||function(t,e){var r;return null!==t?(v[h]=o(t),r=new v,v[h]=null,r[b]=t):r=g(),void 0===e?r:i.f(r,e)}},"7f9a":function(t,e,r){var n=r("da84"),o=r("1626"),i=r("8925"),s=n.WeakMap;t.exports=o(s)&&/native code/.test(i(s))},"825a":function(t,e,r){var n=r("861d"),o=String,i=TypeError;t.exports=function(t){if(n(t))return t;throw i(o(t)+" is not an object")}},"83ab":function(t,e,r){var n=r("d039");t.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},"861d":function(t,e,r){var n=r("1626");t.exports=function(t){return"object"==typeof t?null!==t:n(t)}},8925:function(t,e,r){var n=r("e330"),o=r("1626"),i=r("c6cd"),s=n(Function.toString);o(i.inspectSource)||(i.inspectSource=function(t){return s(t)}),t.exports=i.inspectSource},"90e3":function(t,e,r){var n=r("e330"),o=0,i=Math.random(),s=n(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+s(++o+i,36)}},9112:function(t,e,r){var n=r("83ab"),o=r("9bf2"),i=r("5c6c");t.exports=n?function(t,e,r){return o.f(t,e,i(1,r))}:function(t,e,r){return t[e]=r,t}},"94ca":function(t,e,r){var n=r("d039"),o=r("1626"),i=/#|\.prototype\./,s=function(t,e){var r=a[c(t)];return r==f||r!=u&&(o(e)?n(e):!!e)},c=s.normalize=function(t){return String(t).replace(i,".").toLowerCase()},a=s.data={},u=s.NATIVE="N",f=s.POLYFILL="P";t.exports=s},"9bf2":function(t,e,r){var n=r("83ab"),o=r("0cfb"),i=r("aed9"),s=r("825a"),c=r("a04b"),a=TypeError,u=Object.defineProperty,f=Object.getOwnPropertyDescriptor,l="enumerable",d="configurable",h="writable";e.f=n?i?function(t,e,r){if(s(t),e=c(e),s(r),"function"===typeof t&&"prototype"===e&&"value"in r&&h in r&&!r[h]){var n=f(t,e);n&&n[h]&&(t[e]=r.value,r={configurable:d in r?r[d]:n[d],enumerable:l in r?r[l]:n[l],writable:!1})}return u(t,e,r)}:u:function(t,e,r){if(s(t),e=c(e),s(r),o)try{return u(t,e,r)}catch(n){}if("get"in r||"set"in r)throw a("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},a04b:function(t,e,r){var n=r("c04e"),o=r("d9b5");t.exports=function(t){var e=n(t,"string");return o(e)?e:e+""}},a640:function(t,e,r){"use strict";var n=r("d039");t.exports=function(t,e){var r=[][t];return!!r&&n((function(){r.call(null,e||function(){return 1},1)}))}},ab36:function(t,e,r){var n=r("861d"),o=r("9112");t.exports=function(t,e){n(e)&&"cause"in e&&o(t,"cause",e.cause)}},aeb0:function(t,e,r){var n=r("9bf2").f;t.exports=function(t,e,r){r in t||n(t,r,{configurable:!0,get:function(){return e[r]},set:function(t){e[r]=t}})}},aed9:function(t,e,r){var n=r("83ab"),o=r("d039");t.exports=n&&o((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},b42e:function(t,e){var r=Math.ceil,n=Math.floor;t.exports=Math.trunc||function(t){var e=+t;return(e>0?n:r)(e)}},b622:function(t,e,r){var n=r("da84"),o=r("5692"),i=r("1a2d"),s=r("90e3"),c=r("4930"),a=r("fdbf"),u=o("wks"),f=n.Symbol,l=f&&f["for"],d=a?f:f&&f.withoutSetter||s;t.exports=function(t){if(!i(u,t)||!c&&"string"!=typeof u[t]){var e="Symbol."+t;c&&i(f,t)?u[t]=f[t]:u[t]=a&&l?l(e):d(e)}return u[t]}},b980:function(t,e,r){var n=r("d039"),o=r("5c6c");t.exports=!n((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",o(1,7)),7!==t.stack)}))},c04e:function(t,e,r){var n=r("c65b"),o=r("861d"),i=r("d9b5"),s=r("dc4a"),c=r("485a"),a=r("b622"),u=TypeError,f=a("toPrimitive");t.exports=function(t,e){if(!o(t)||i(t))return t;var r,a=s(t,f);if(a){if(void 0===e&&(e="default"),r=n(a,t,e),!o(r)||i(r))return r;throw u("Can't convert object to primitive value")}return void 0===e&&(e="number"),c(t,e)}},c430:function(t,e){t.exports=!1},c65b:function(t,e,r){var n=r("40d5"),o=Function.prototype.call;t.exports=n?o.bind(o):function(){return o.apply(o,arguments)}},c6b6:function(t,e,r){var n=r("e330"),o=n({}.toString),i=n("".slice);t.exports=function(t){return i(o(t),8,-1)}},c6cd:function(t,e,r){var n=r("da84"),o=r("6374"),i="__core-js_shared__",s=n[i]||o(i,{});t.exports=s},c770:function(t,e,r){var n=r("e330"),o=Error,i=n("".replace),s=function(t){return String(o(t).stack)}("zxcasd"),c=/\n\s*at [^:]*:[^\n]*/,a=c.test(s);t.exports=function(t,e){if(a&&"string"==typeof t&&!o.prepareStackTrace)while(e--)t=i(t,c,"");return t}},c8ba:function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(n){"object"===typeof window&&(r=window)}t.exports=r},ca84:function(t,e,r){var n=r("e330"),o=r("1a2d"),i=r("fc6a"),s=r("4d64").indexOf,c=r("d012"),a=n([].push);t.exports=function(t,e){var r,n=i(t),u=0,f=[];for(r in n)!o(c,r)&&o(n,r)&&a(f,r);while(e.length>u)o(n,r=e[u++])&&(~s(f,r)||a(f,r));return f}},caad:function(t,e,r){"use strict";var n=r("23e7"),o=r("4d64").includes,i=r("d039"),s=r("44d2"),c=i((function(){return!Array(1).includes()}));n({target:"Array",proto:!0,forced:c},{includes:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),s("includes")},cb2d:function(t,e,r){var n=r("1626"),o=r("9bf2"),i=r("13d2"),s=r("6374");t.exports=function(t,e,r,c){c||(c={});var a=c.enumerable,u=void 0!==c.name?c.name:e;if(n(r)&&i(r,u,c),c.global)a?t[e]=r:s(e,r);else{try{c.unsafe?t[e]&&(a=!0):delete t[e]}catch(f){}a?t[e]=r:o.f(t,e,{value:r,enumerable:!1,configurable:!c.nonConfigurable,writable:!c.nonWritable})}return t}},cc12:function(t,e,r){var n=r("da84"),o=r("861d"),i=n.document,s=o(i)&&o(i.createElement);t.exports=function(t){return s?i.createElement(t):{}}},d012:function(t,e){t.exports={}},d039:function(t,e){t.exports=function(t){try{return!!t()}catch(e){return!0}}},d066:function(t,e,r){var n=r("da84"),o=r("1626"),i=function(t){return o(t)?t:void 0};t.exports=function(t,e){return arguments.length<2?i(n[t]):n[t]&&n[t][e]}},d1e7:function(t,e,r){"use strict";var n={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,i=o&&!n.call({1:2},1);e.f=i?function(t){var e=o(this,t);return!!e&&e.enumerable}:n},d2bb:function(t,e,r){var n=r("e330"),o=r("825a"),i=r("3bbe");t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{t=n(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set),t(r,[]),e=r instanceof Array}catch(s){}return function(r,n){return o(r),i(n),e?t(r,n):r.__proto__=n,r}}():void 0)},d58f:function(t,e,r){var n=r("59ed"),o=r("7b0b"),i=r("44ad"),s=r("07fa"),c=TypeError,a=function(t){return function(e,r,a,u){n(r);var f=o(e),l=i(f),d=s(f),h=t?d-1:0,p=t?-1:1;if(a<2)while(1){if(h in l){u=l[h],h+=p;break}if(h+=p,t?h<0:d<=h)throw c("Reduce of empty array with no initial value")}for(;t?h>=0:d>h;h+=p)h in l&&(u=r(u,l[h],h,f));return u}};t.exports={left:a(!1),right:a(!0)}},d9b5:function(t,e,r){var n=r("d066"),o=r("1626"),i=r("3a9b"),s=r("fdbf"),c=Object;t.exports=s?function(t){return"symbol"==typeof t}:function(t){var e=n("Symbol");return o(e)&&i(e.prototype,c(t))}},d9e2:function(t,e,r){var n=r("23e7"),o=r("da84"),i=r("2ba4"),s=r("e5cb"),c="WebAssembly",a=o[c],u=7!==Error("e",{cause:7}).cause,f=function(t,e){var r={};r[t]=s(t,e,u),n({global:!0,constructor:!0,arity:1,forced:u},r)},l=function(t,e){if(a&&a[t]){var r={};r[t]=s(c+"."+t,e,u),n({target:c,stat:!0,constructor:!0,arity:1,forced:u},r)}};f("Error",(function(t){return function(e){return i(t,this,arguments)}})),f("EvalError",(function(t){return function(e){return i(t,this,arguments)}})),f("RangeError",(function(t){return function(e){return i(t,this,arguments)}})),f("ReferenceError",(function(t){return function(e){return i(t,this,arguments)}})),f("SyntaxError",(function(t){return function(e){return i(t,this,arguments)}})),f("TypeError",(function(t){return function(e){return i(t,this,arguments)}})),f("URIError",(function(t){return function(e){return i(t,this,arguments)}})),l("CompileError",(function(t){return function(e){return i(t,this,arguments)}})),l("LinkError",(function(t){return function(e){return i(t,this,arguments)}})),l("RuntimeError",(function(t){return function(e){return i(t,this,arguments)}}))},da84:function(t,e,r){(function(e){var r=function(t){return t&&t.Math==Math&&t};t.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof e&&e)||function(){return this}()||Function("return this")()}).call(this,r("c8ba"))},dc4a:function(t,e,r){var n=r("59ed");t.exports=function(t,e){var r=t[e];return null==r?void 0:n(r)}},df75:function(t,e,r){var n=r("ca84"),o=r("7839");t.exports=Object.keys||function(t){return n(t,o)}},e330:function(t,e,r){var n=r("40d5"),o=Function.prototype,i=o.bind,s=o.call,c=n&&i.bind(s,s);t.exports=n?function(t){return t&&c(t)}:function(t){return t&&function(){return s.apply(t,arguments)}}},e391:function(t,e,r){var n=r("577e");t.exports=function(t,e){return void 0===t?arguments.length<2?"":e:n(t)}},e5cb:function(t,e,r){"use strict";var n=r("d066"),o=r("1a2d"),i=r("9112"),s=r("3a9b"),c=r("d2bb"),a=r("e893"),u=r("aeb0"),f=r("7156"),l=r("e391"),d=r("ab36"),h=r("c770"),p=r("b980"),b=r("83ab"),v=r("c430");t.exports=function(t,e,r,_){var m="stackTraceLimit",y=_?2:1,g=t.split("."),w=g[g.length-1],x=n.apply(null,g);if(x){var E=x.prototype;if(!v&&o(E,"cause")&&delete E.cause,!r)return x;var k=n("Error"),S=e((function(t,e){var r=l(_?e:t,void 0),n=_?new x(t):new x;return void 0!==r&&i(n,"message",r),p&&i(n,"stack",h(n.stack,2)),this&&s(E,this)&&f(n,this,S),arguments.length>y&&d(n,arguments[y]),n}));if(S.prototype=E,"Error"!==w?c?c(S,k):a(S,k,{name:!0}):b&&m in x&&(u(S,x,m),u(S,x,"prepareStackTrace")),a(S,x),!v)try{E.name!==w&&i(E,"name",w),E.constructor=S}catch(O){}return S}}},e893:function(t,e,r){var n=r("1a2d"),o=r("56ef"),i=r("06cf"),s=r("9bf2");t.exports=function(t,e,r){for(var c=o(e),a=s.f,u=i.f,f=0;f<c.length;f++){var l=c[f];n(t,l)||r&&n(r,l)||a(t,l,u(e,l))}}},f5df:function(t,e,r){var n=r("00ee"),o=r("1626"),i=r("c6b6"),s=r("b622"),c=s("toStringTag"),a=Object,u="Arguments"==i(function(){return arguments}()),f=function(t,e){try{return t[e]}catch(r){}};t.exports=n?i:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=f(e=a(t),c))?r:u?i(e):"Object"==(n=i(e))&&o(e.callee)?"Arguments":n}},f772:function(t,e,r){var n=r("5692"),o=r("90e3"),i=n("keys");t.exports=function(t){return i[t]||(i[t]=o(t))}},fb15:function(t,e,r){"use strict";if(r.r(e),r.d(e,"ChainSyncer",(function(){return x})),r.d(e,"InMemoryAdapter",(function(){return S})),"undefined"!==typeof window){var n=window.document.currentScript,o=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);o&&(r.p=o[1])}function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}r("d9e2"),r("13d5");const s=async function(t){const e=t.reduce((t,e)=>[...t,...e.events],[]),r=await this._loadUsedBlocks(e),n=await this._loadUsedTxs(e),o=t.map(t=>t.events.map(e=>this.parseEvent(t.contract_name,e,r.find(t=>t.number===e.blockNumber),n.find(t=>t.hash===e.transactionHash)))).reduce((t,e)=>[...t,...e],[]);return await this.adapter.saveEvents(o,this.subscribers),o};r("caad");const c=async function(t,e){if("mono"!==this.mode)throw new Error("Inline listeners are only available in mono mode");if(this._is_started)throw new Error("Unfortunately, you cannot add new listeners after module started");const{contract_name:r,event_name:n}=this._parseListenerName(t);this.used_contracts.includes(r)||this.used_contracts.push(r),this.listeners[t]={full_event:t,listener:e,contract_name:r,event_name:n}},a=async function(t,e){const{events_added:r,events_removed:n}=await this.adapter.updateSubscriber(t,e);r.length&&await this.adapter.addUnprocessedEventsToQueue(t,r),n.length&&await this.adapter.removeQueue(t,n),await this.syncSubscribers()},u=async function(t,e,r={}){let n=await this.adapter.getLatestScannedBlockNumber(t);const o=await this.contractsGetter(t,{max_block:e,from_block:n||0});if(!n){if(!o.deployed_transaction_hash)return void console.error(t,"has no deploy tx hash",o.deployed_transaction_hash);try{var i=await this.ethers_provider.getTransaction(o.deployed_transaction_hash)}catch(a){return void console.error("There's a problem fetching contract's deploy transaction. TX:",o.deployed_transaction_hash)}try{n=i.blockNumber}catch(a){throw new Error("Looks like you are trying to fetch quite an old tx, check archive_ethers_provider parameter. Error: "+a.message)}}let s=n+this.query_block_limit;if(s>e&&(s=e),n===s&&n<0&&(n=0),r.force_rescan_till){const t=Math.max(0,r.force_rescan_till);if(!(s>t))return;n=t}const c=await this.scanContractBlocks(o,t,n,s);return c},f={_uniq(t){let e={};return t.filter((function(t){return!e.hasOwnProperty(t)&&(e[t]=!0)}))},_parseListenerName(t){const e=t.replace(/\#.*$/,"").split("."),r=e[0],n=e[1];if(!(r||"").length||!(n||"").length)throw new Error("Invalid listener format! Must be ContractName.EventName");return{contract_name:r,event_name:n}},_parseEventId(t){return t.transactionHash+"_"+t.logIndex},async _loadUsedBlocks(t){let e=this._uniq(t.map(t=>t.blockNumber));return e=await Promise.all(e.map(t=>this.ethers_provider.getBlock(t).catch(e=>(console.error(`getBlock error in ${t} block`),null)))),e=e.filter(t=>t),e},async _loadUsedTxs(t){let e=this._uniq(t.map(t=>t.transactionHash));return e=await Promise.all(e.map(t=>this.ethers_provider.getTransaction(t).catch(e=>(console.error(`getTransaction error in ${t} tx`),null)))),e=e.filter(t=>t),e}},l=t=>t.toString().padStart(6,"0"),d=function(t,e,r,n){if(!n)throw new Error("Event has no tx, trying to fetch again (problem with RPC)");if(!r)throw new Error("Event has no block, trying to fetch again (problem with RPC)");const o={id:this._parseEventId(e),contract:t,event:e.event,transaction_hash:e.transactionHash,block_number:e.blockNumber,log_index:e.logIndex,tx_index:e.transactionIndex,from_address:n.from,global_index:Number(e.blockNumber.toString()+l(e.logIndex))},i=t=>Array.isArray(t)?t.map(t=>i(t)):t._isBigNumber?t.toString():t,s=i(e.args);return{...o,block_timestamp:r.timestamp,args:s}},h=t=>`${t.contract}.${t.event}`,p=async function(t){let e=await this.adapter.selectAllUnprocessedEventsBySubscriber(t);e=e.filter(t=>!!this.listeners[h(t)]),await Promise.all(e.map(async e=>{const r=e,n=h(r),{listener:o}=this.listeners[n];try{const t=await o(...r.args,{block_number:r.block_number,transaction_hash:r.transaction_hash,block_timestamp:r.block_timestamp,global_index:r.global_index,from_address:r.from_address});if(!1===t)return void(this.verbose&&console.log("Postponed event",n))}catch(i){return void console.error("Error during event processing",n,i)}try{await this.adapter.setEventProcessedForSubscriber(r.id,t)}catch(i){console.error("Error during event stream state setter",i)}}))},b=async function(t){const e=[];for(const r in this.subscribers){const t=this.subscribers[r];e.push(this.processSubscriberEvents(t.name).catch(t=>console.error(t)))}await Promise.all(e),this._start_sid===t&&(this._processing_timeout=setTimeout(()=>this.processingTick(t),this.tick_interval))},v=async function(t){if(t<this._next_safe_at)return;t-=1;const e=t-2*this.safe_rescan_every_n_block,{scans:r,events:n}=await this.scanContracts(t,{force_rescan_till:e});this._next_safe_at=t+this.safe_rescan_every_n_block,this.verbose&&console.log("Safe rescan ...",n.length,"events added. Next rescan at",this._next_safe_at)},_=async function(t){await Promise.all(t.map(t=>this.adapter.saveLatestScannedBlockNumber(t.contract_name,t.block)))},m=async function(t,e,r,n){if(n-r<this.blocks_amount_to_activate_archive_rpc)var o=this.ethers_provider;else o=this.archive_ethers_provider;let i=await t.inst.connect(o).queryFilter({},r,n);i=i.filter(t=>{const e=t;return e.event&&e.args});const s=await this.adapter.filterExistingEvents(i.map(t=>this._parseEventId(t)));return i=i.filter(t=>{const e=this._parseEventId(t);return s.includes(e)}),{contract_name:e,events:i,block:n}},y=async function(t,e={}){let r=[];const n=this.used_contracts.filter(t=>!this.ignore_contracts.includes(t));for(const s in n){const o=n[s],i=this.getContractEvents(o,t,e).catch(t=>(console.error("Error in gethering events for contract",o+":",t.message),null));r.push(i)}let o=[],i=[];return r.length&&(o=await Promise.all(r).then(t=>t.filter(t=>t)),i=await this.addEvents(o)),{scans:o,events:i}},g=async function(t){try{var e=await this.ethers_provider.getBlockNumber()}catch(r){console.error("Error while fetching max_block, will try again anyway:",r?r.message:"Unknown error")}if(e>=0)try{const{scans:t,events:r}=await this.scanContracts(e);t.length?(await this.saveLatestBlocks(t),this.verbose&&console.log(`[MAXBLOCK: ${e}]`,r.length,"events added"),await this.safeRescan(e)):this.verbose&&console.log(`[MAXBLOCK: ${e}]`,"No scans executed")}catch(r){console.error("Error in scanner",r)}this._start_sid===t&&(this._scanner_timeout=setTimeout(()=>this.scannerTick(t),this.block_time))},w=async function(){this.subscribers=await this.adapter.selectAllSubscribers();const t=this.subscribers.reduce((t,e)=>t.concat(e.events),[]);t.forEach(t=>{const{contract_name:e}=this._parseListenerName(t);this.used_contracts.includes(e)||this.used_contracts.push(e)})};class x{constructor(t,e={}){i(this,"listeners",[]),i(this,"used_contracts",[]),i(this,"subscribers",[]),i(this,"_next_safe_at",0),i(this,"_is_started",!1),i(this,"_start_sid",0),i(this,"syncSubscribers",w),i(this,"scannerTick",g),i(this,"processingTick",b),i(this,"processSubscriberEvents",p),i(this,"updateSubscriber",a),i(this,"addEvents",s),i(this,"getContractEvents",u),i(this,"saveLatestBlocks",_),i(this,"scanContractBlocks",m),i(this,"parseEvent",d),i(this,"on",c),i(this,"scanContracts",y),i(this,"safeRescan",v);const{tick_interval:r=2e3,query_block_limit:n=200,blocks_amount_to_activate_archive_rpc:o=100,safe_rescan_every_n_block:l=100,mode:h="mono",ignore_contracts:x=[],verbose:E=!1,contracts:k=[],archive_ethers_provider:S,block_time:O,contractsGetter:j,ethers_provider:P}=e;if(n<2*l)throw new Error("query_block_limit cannot be less than safe_rescan_every_n_block * 2");if(!j)throw new Error("contractsGetter argument is required");if(!P)throw new Error("ethers_provider argument is required");if(!O)throw new Error("block_time argument is required");if(k.length&&"scanner"!==h)throw new Error("contracts argument are only available in scanner mode");this.query_block_limit=n,this.block_time=O,this.tick_interval=r,this.adapter=t,this.mode=h,this.ethers_provider=P,this.archive_ethers_provider=S||P,this.contractsGetter=j,this.ignore_contracts=x,this.verbose=E,this.blocks_amount_to_activate_archive_rpc=o,this.safe_rescan_every_n_block=l,Object.assign(this,f)}async start(){if(this._is_started)throw new Error("Already started");const t=this._start_sid;await this.syncSubscribers(),"mono"===this.mode&&await this.updateSubscriber("mono",Object.keys(this.listeners)),"mono"!==this.mode&&"scanner"!==this.mode||this.scannerTick(t),"mono"===this.mode&&this.processingTick(t),this._is_started=!0}stop(){clearTimeout(this._processing_timeout),clearTimeout(this._scanner_timeout),this._start_sid++,this._is_started=!1}async selectPendingEvents(t){return this.adapter.selectAllUnprocessedEventsBySubscriber(t)}async markEventsAsProcessed(t,e){await Promise.all(e.map(e=>this.adapter.setEventProcessedForSubscriber(e,t)))}}class E{constructor(t){i(this,"id",void 0),i(this,"contract",void 0),i(this,"event",void 0),i(this,"transaction_hash",void 0),i(this,"block_number",void 0),i(this,"log_index",void 0),i(this,"tx_index",void 0),i(this,"from_address",void 0),i(this,"global_index",void 0),i(this,"block_timestamp",void 0),i(this,"args",void 0),i(this,"processed_subscribers",void 0),this.id=t.id,this.contract=t.contract,this.event=t.event,this.transaction_hash=t.transaction_hash,this.block_number=t.block_number,this.log_index=t.log_index,this.tx_index=t.tx_index,this.from_address=t.from_address,this.global_index=t.global_index,this.block_timestamp=t.block_timestamp,this.args=t.args||[],this.processed_subscribers={}}}class k{constructor(t,e){i(this,"id",void 0),i(this,"event_id",void 0),i(this,"event",void 0),i(this,"contract",void 0),i(this,"subscriber",void 0),this.id=t.id+"_"+e,this.event_id=t.id,this.event=t.event,this.contract=t.contract,this.subscriber=e}}class S{constructor(){i(this,"latest_blocks",{}),i(this,"events",[]),i(this,"events_queue",[]),i(this,"subscribers",{}),i(this,"_is_chainsyncer_adapter",!0)}async getLatestScannedBlockNumber(t){const e=this.latest_blocks[t];return e||0}async removeQueue(t,e){const r=e.map(e=>{const[r,n]=e.split(".");return this.events_queue.findIndex(e=>e.event===n&&e.contract===r&&e.subscriber===t)});r.forEach(t=>{this.events_queue.splice(t,1)})}async addUnprocessedEventsToQueue(t,e){e.forEach(e=>{const[r,n]=e.split("."),o=this.events.filter(e=>!e.processed_subscribers[t]&&e.contract===r&&e.event===n);this.events_queue.push(...o.map(e=>new k(e,t)))})}async selectAllSubscribers(){return[...Object.values(this.subscribers)]}async updateSubscriber(t,e){e=[...e.sort()],this.subscribers[t]||(this.subscribers[t]={name:t,events:[],added_at:{...this.latest_blocks}});const r=e.filter(e=>!this.subscribers[t].events.includes(e)),n=this.subscribers[t].events.filter(t=>!e.includes(t));return this.subscribers[t].events=e,{events_added:r,events_removed:n}}async saveLatestScannedBlockNumber(t,e){this.latest_blocks[t]=e}async selectAllUnprocessedEventsBySubscriber(t){const e=this.events_queue.filter(e=>e.subscriber===t).map(t=>t.event_id),r=this.events.filter(t=>e.includes(t.id));return r}async setEventProcessedForSubscriber(t,e){const r=this.events.find(e=>e.id===t);if(r){r.processed_subscribers[e]=!0;const n=t+"_"+e,o=this.events_queue.findIndex(t=>t.id===n);-1!==o&&this.events_queue.splice(o,1)}}async filterExistingEvents(t){const e=this.events.filter(e=>t.includes(e.id)).map(t=>t.id);return t=t.filter(t=>!e.includes(t)),t}async saveEvents(t,e){if(!t.length)return;t=t.map(t=>new E(t));const r=await this.filterExistingEvents(t.map(t=>t.id));if(r.length!==t.length)throw new Error("Some events already exist");this.events.push(...t);for(const n in e){const r=e[n],o=t.filter(t=>{const e=t.contract+"."+t.event;return r.events.includes(e)});this.events_queue.push(...o.map(t=>new k(t,r.name)))}}}var O=x;e["default"]=O},fc6a:function(t,e,r){var n=r("44ad"),o=r("1d80");t.exports=function(t){return n(o(t))}},fdbf:function(t,e,r){var n=r("4930");t.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator}})}));
//# sourceMappingURL=chain-syncer.umd.min.js.map